{% extends "wagtailadmin/base.html" %}
{% load wagtailadmin_tags %}

{% block titletag %}Translations List{% endblock %}
{% block bodyclass %}listing{% endblock %}

{% block content %}
    <div>
        <style>
            .page-slug {
                font-size: 11px;
                color: #666;
                font-weight: normal;
                margin-top: 4px;
                font-family: monospace;
            }
            .status-published {
                color: #007d7e;
                font-weight: 500;
            }
            .status-draft {
                color: #cd7213;
                font-weight: 500;
            }
            .no-translations {
                color: #666;
                font-style: italic;
                font-size: 12px;
            }
            .flex {
                display: flex;
            }
            .pl-4em {
                padding-left: 4em;
            }
            .align-items-end {
                align-items: flex-end;
            }
            .actions .button {
                border: none;
                border-radius: 8px;
                margin: 0;
            }
            .actions.actions-inline-start {
                float: inline-start;
            }
            .button.btn-success {
                background-color: var(--w-color-positive-100);
                color: var(--w-color-white);
            }
            .button.btn-warning {
                background-color: var(--w-color-warning-100);
                color: var(--w-color-white);
            }
            .button.btn-warning:hover {
                color: var(--w-color-warning-100);
            }
            .button.btn-danger {
                background-color: var(--w-color-critical-200);
                color:var(--w-color-white);
            }
            .button.btn-danger:hover {
                color: var(--w-color-critical-200);
            }
        </style>

        <header class="w-sticky w-top-0 w-z-header pl-4em">
            <div class="merged-header__icon icon icon-wagtail-localize-language"></div>
            <h1 class="w-pl-slim-header sm:w-pl-5 w-min-h-slim-header sm:w-pr-2 w-w-full w-flex-1 w-overflow-x-auto w-box-border">Translations List</h1>
        </header>

        <div class="pl-4em">
            <form method="get" class="w-flex w-flex-wrap w-gap-4 w-items-end sm:w-pl-5">
                <div class="w-flex w-flex-col">
                    {{ filter_form.search.label_tag }}
                    {{ filter_form.search }}
                </div>
                <div class="w-flex w-flex-col">
                    {{ filter_form.original_language.label_tag }}
                    {{ filter_form.original_language }}
                </div>
                <div class="w-flex w-flex-col">
                    {{ filter_form.exists_in_language.label_tag }}
                    {{ filter_form.exists_in_language }}
                </div>
                <div class="w-flex w-flex-col">
                    {{ filter_form.translation_key.label_tag }}
                    {{ filter_form.translation_key }}
                </div>
                <div class="flex align-items-end">
                    <button type="submit" class="button">Filter</button>
                    {% if filter_form.search.value or filter_form.original_language.value or filter_form.exists_in_language.value or filter_form.translation_key.value %}
                        <a href="?" class="button button-secondary">Clear</a>
                    {% endif %}
                </div>
            </form>
        </div>

        {% if pages_with_translations %}
            <div class="w-py-6">
                <table class="listing full-width">
                    <thead>
                        <tr class="table-headers">
                            <th class="title">Page Title</th>
                            <th>Status</th>
                            <th>Translations</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for page_data in pages_with_translations %}
                            <tr>
                                <td class="title">
                                    <div class="title-wrapper">
                                        <h2>
                                            <a href="{{ page_data.edit_url }}">{{ page_data.page.get_admin_display_title }}</a>
                                        </h2>
                                        <div class="page-slug">{{ page_data.page.get_url }}</div>
                                    </div>
                                </td>
                                <td>
                                    {% if page_data.page.live %}
                                        <span class="status-tag primary status-published">Published</span>
                                    {% else %}
                                        <span class="status-tag status-draft">Draft</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if page_data.translations %}
                                        <div class="actions actions-inline-start">
                                            {% for translation in page_data.translations %}
                                                <a href="{{ translation.edit_url }}" class="button button-small button-secondary {% if translation.percent_translated == 100 %}btn-success{% elif translation.percent_translated >= 80 %}btn-warning{% else %}btn-danger{% endif %}" title="Edit {{ translation.locale }} version">
                                                    {% if translation.percent_translated == 100 %}
                                                      {% icon name="circle-check" %}
                                                    {% else %}
                                                      {% icon name="warning" %}
                                                    {% endif %}
                                                    {{ translation.locale.upper }} {% if translation.percent_translated != 100 %}{{ translation.percent_translated }}%{% endif %}
                                                </a>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <span class="no-translations">No translations</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="actions actions-inline-start">
                                        <a href="{{ page_data.edit_url }}" class="button button-small">Edit</a>
                                        {% if page_data.page.live %}
                                            <a href="{{ page_data.view_url }}" class="button button-small button-secondary" target="_blank">View</a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            {% if is_paginated %}
                {% include "wagtailadmin/shared/pagination_nav.html" with items=page_obj %}
            {% endif %}
        {% else %}
            <p class="pl-4em w-pt-4"><span class="sm:w-pl-5">No pages found.</span></p>
        {% endif %}
    </div>
{% endblock %}
